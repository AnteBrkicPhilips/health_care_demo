plugins {
    id 'java'
}

java {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

repositories {
    mavenCentral()
    flatDir {
        dirs 'lib'
    }
}

configurations {
    download
}
dependencies {
    download 'com.h2database:h2:2.3.232'
    download 'p6spy:p6spy:3.9.1'
    download 'io.opentelemetry:opentelemetry-api:1.32.0'
    download 'io.opentelemetry:opentelemetry-sdk:1.32.0'
    download 'junit:junit:4.13.2'
    download 'org.hamcrest:hamcrest-core:1.3'
}
def libDir = file("lib")

task copyDependenciesToLib(type: Copy) {
    from configurations.download
    into libDir
}

task runApp(type: JavaExec) {
    dependsOn classes
    mainClass = 'com.example.healthcare.HealthcareSystem'
    classpath = sourceSets.main.runtimeClasspath + files("lib/opentelemetry-javaagent.jar")
    jvmArgs = [
            "-javaagent:lib/opentelemetry-javaagent.jar",
            "-Dotel.service.name=your-service-name",
            "-Dotel.traces.exporter=logging",
            "-Dotel.metrics.exporter=logging"
    ]
    systemProperties = [
            "spy.properties": "src/main/resources/spy.properties"
    ]
}

test {
    useJUnit()
    testLogging.showStandardStreams = true
}

def reportsDir = file("build/test-reports")
test.reports.junitXml.destination = reportsDir
